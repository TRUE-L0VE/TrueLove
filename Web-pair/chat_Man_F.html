<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>true-love</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  </head>
  <body>
    <nav class="navbar navbar-dark background-color-dark" style="background-color: #4d826c;">
            <div class="container-fluid">
              <a class="navbar-brand" href="/home" style="color:wheat">&nbsp;TRUE LOVE</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation" style="color:#4d826c">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                  <a class="nav-link active" aria-current="page" href="/home" style="color:white">&nbsp; Home</a>
                  <a class="nav-link active" href="/test" style="color:white">&nbsp; Test</a>
                  <a class="nav-link active" href="/chat" style="color:white">&nbsp; Chat</a>
                  <a class="nav-link active" href="/info" style="color:white">&nbsp; Info</a>
                </div>
              </div>
            </div>
          </nav>
      </nav>

      <div class="jumbotron">
        <h1 class="display-4">&nbsp;Chat with Man-F!</h1>
        <p class="lead">&nbsp;&nbsp;&nbsp;This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information.</p>
        <hr class="my-4">
        <p>&nbsp;&nbsp;&nbsp;It uses utility classes for typography and spacing to space content out within the larger container.</p>
        <!-- <p class="lead">
          <a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a>
        </p> -->
      </div>

      <div class="w-75 position-absolute top-50 start-50 translate-middle">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Send a message" aria-label="input voice" autocomplete="off">
        <button class="btn btn-outline-secondary dictate" type="button" id="button-addon2">
            <i class="ic-mike"></i>
            <a>&nbsp;VOICE</a>
            <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor" class="bi bi-mic" viewBox="2 2 20 16">
                <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
                <path d="M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0v5zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z"/>
              </svg>
        </button>
        <button class="btn btn-outline-secondary" type="button">
            <a>&nbsp;SEND</a>
            <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor" class="bi bi-send" viewBox="2 2 20 16">
                <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
              </svg>
        </button>
      </div>
      </div>

    <script>
    //src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"
	const $ = (el) => document.querySelector(el);
	
	const store = {
		texts : '',
		isRecognizing: true
	};

	(() => {
		/* Speech API start */
		let SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
		if(!("webkitSpeechRecognition" in window)){
			alert("지원 안되는 브라우저 입니다. !")
		} else {			
			const recognition = new SpeechRecognition();
			recognition.interimResults = true; // true면 음절을 연속적으로 인식하나 false면 한 음절만 기록함
			recognition.lang = 'ko-KR'; // 값이 없으면 HTML의 <html lang="en">을 참고합니다. ko-KR, en-US
			recognition.continuous = false; //각 인식에 대해 연속 결과가 반환되는지 아니면 단일 결과만 반환되는지를 제어합니다. 기본값은 단일( false.)
			recognition.maxAlternatives = 20000; // maxAlternatives가 숫자가 작을수록 발음대로 적고, 크면 문장의 적합도에 따라 알맞은 단어로 대체합니다.

			recognition.onspeechend = function() { // 음성 감지가 끝날때 실행될 이벤트
				recognition.stop();
				$('.dictate').classList.remove("on");
				store.isRecognizing = true;
			};

			recognition.onresult = function(e) { //result이벤트는 음성 인식 서비스가 결과를 반환할 때 시작됩니다.
				store.texts = Array.from(e.results)
								.map(results => results[0].transcript).join("");

				console.log(store.texts)
				$('input').value = store.texts;
			};
			/* // Speech API END */

			const active = () => {
				$('.dictate').classList.add('on')
				recognition.start();
				store.isRecognizing = false;
			};

			const unactive = () => {
				$('.dictate').classList.remove('on')
				recognition.stop();
				store.isRecognizing = true;
			};

			$('.dictate').addEventListener('click', () => {
				if(store.isRecognizing){
					active();
				} else {
					unactive();
				}
			});
		}
	})();
</script>
</body>
</html>